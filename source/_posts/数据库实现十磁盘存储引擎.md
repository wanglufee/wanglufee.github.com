---
title: 数据库实现十磁盘存储引擎
date: 2024-11-16 09:52:07
tags: 数据库
categories: rust，数据库
---
## 磁盘模型概述
上一节我们完成了基于内存的存储引擎，但是内存中的数据，掉电之后就会丢失，无法完成持久化的操作，因此我们还是要实现一个基于磁盘的存储引擎，这样可以把数据都写入到磁盘中，即使掉电，数据也可以保存。
常见的磁盘存储模型有 LSM Tree,B+ Tree,Bitcask。
### LSM Tree
LSM Tree 会先将数据写入到内存的数据结构中，然后定期将内存中的数据批量写入到磁盘，形成不变的排序文件。当内存缓冲区满了之后，会将内存缓冲区写入磁盘并生成新的内存缓冲区。而且 LSM Tree 还会定期进行合并操作，将多个排序文件合并成一个，防止需要查找多个文件。

优点：
- 写性能高
- 空间利用率高

缺点：
- 都性能可能受影响
- 合并多个排序文件成本高

### B+ Tree
B+ Tree 是一种平衡树结构，数据全部存储在叶子节点，路径上的节点只作为 key，并且是有序的。由于所有叶子节点高度一致，所以 B+ Tree 的读取性能稳定，但由于写入和删除操作可能会触发 Rebalance 操作，影响性能。

优点：
- 读性能高
- 范围查询高效

缺点：
- 写性能相对较低
- 空间利用率较低

### Bitcask
Bitcask 采用日志文件存储，所有的写操作到追加到日志文件末尾，读操作则通过内存中索引查找键对应值的位置来读取数据。Bitcask 也会定期进行数据压缩，移除无用的数据和重复的键。Bitcask 数据是无序的。

优点：
- 写性能高
- 读性能高
- 实现简单

缺点：
- 内存消耗大
- 不适合频繁更新

这是几种磁盘的存储模型，各自有各自的优点和缺点，我们这里采用 Bitcask 来实现，主要是因为实现简单。下一节开始具体实现。
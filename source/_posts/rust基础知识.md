---
title: rust基础知识
date: 2024-03-20 16:13:42
tags: 基础知识
categories: rust
---
## 变量与可变性
在rust中通过 let 关键字来声明一个变量，并未变量绑定一个值，变量默认为不可变，即初始化之后无法对变量做出修改，可以不显示指定变量类型，编译器会自动推断。
```rust
    let a = 5;
    a = 10  // 无法修改，会出错

    let b: i32 = 5;   // 可以在变量名后跟 :变量类型  的方式来指定变量类型
```
通过 mut 关键字使得变量具有可变性。
```rust
    let mut a = 5;  // 通过 mut 关键字声明变量，则变量具有可变性
    a = 10; // 可以更改变量
```
常量在rust中与不可变变量类似，但常量在声明时需要使用 const 关键字，并且在声明时必须指定类型，赋值只能为一个常量表达式，不能为一个需要在运行时得出的值。
```rust
    const NUM: i32 = 100 * 100;
```
rust中变量具有遮蔽行为，即在一个变量定义之后，可以使用相同的变量名来遮蔽之前的变量。遮蔽与可变性不同，遮蔽可以理解为重新创建了一个新的变量，类型可与之前不同。
```rust
    let a = 5;
    ···
    let a = "hello";  // 在此之前变量 a 的值为5，之后值为 hello
```
## 函数
rust中函数的入口时 main 函数，默认情况下 main 函数没有参数和返回值。
```rust
    fn main() {

    }
```
函数的参数需要显示的指定类型，返回值类型则跟在小括号后。
```rust
    fn function(x:i32) -> i32 { // 需要一个 i32 类型的参数，返回一个 i32 的值。
        x
    }
```
语句与表达式，语句不会返回值，表达式会返回值。表达式可以赋值给另一个变量，而语句不可以。同理表达式可以作为函数的返回值，比如上面函数返回 x
```rust
    let a = 10;   // 这是一条语句，没有返回值
    a   // 这是一个表达式，会返回 a 
```
## 控制流
if 判断语句，直接在 if 后跟判断的条件即可，注意在 rust 中 if 是一个表达式，会产生值，可以赋值给另一个变量。
```rust
    if a > 5 {
        println!("a>5");
    } else {
        println!("a<=5");
    }
    // 返回两个数中的较大值
    let max = if a>b {
        a
    } else {
        b
    };
    // if 后同样可以接多个 else if
    if a > 90 {
        ···
    } else if a > 80 {
        ···
    } else if a > 70 {
        ···
    } else {
        ···
    }
```
loop 循环语句，执行循环，直到代码指定跳出，否则一直循环下去，loop 同样属于语句，可以有返回值，返回值可通过 break 返回。
```rust
    let mut a = 0;
    let b = loop {
        a = a + 1;
        if a > 100 {
            break a;    // 这里 break 指定跳出循环，并返回值给变量 b
        }
    };
```
while 条件循环，当条件为真时，执行循环，为假时跳出循环
```rust
    let mut a = 0;
    while a < 100 {
        a = a + 1;
    }
```
for 循环，相比 while 循环，for 循环在遍历集合中的元素时更加方便。并且不会出现越界的行为。
```rust
    let a = [1,2,3,4,5,6];

    for i in a {
        println!("a{i}={i}");
    }
```
## 所有权
所有权是rust特有的特性，同样也是核心功能之一，保证rust在没有gc的情况下还能够做到内存安全。

rust所有权有三个规则：
- Rust 中的每一个值都有一个被称为其 所有者（owner）的变量。
- 值在任一时刻只有一个所有者。
- 当所有者离开作用域，值将被丢弃。

首先来看作用域：
```rust
{                               // s 未进行声明，不可使用
    let s = "hello";            // 声明变量 s 变量 s 有效，可使用


}                               // 离开作用域，变量 s 无效，值被丢弃
```
接下来需要介绍一下栈内存和堆内存，在rust中，如果数据的大小是固定的且已知的，那么会被存放在栈内存中，否则将会被存放在堆内存，所有权更主要是管理堆上的内存空间。

以String类型为例：String字符串在创建是未知大小，所以会被分配到堆空间。
```rust
{
    let mut s = String::from("hello");      // 在堆空间分配内存存放值
    s.push_str("world");                    // 在字符串值后追加内容
}                                           
```